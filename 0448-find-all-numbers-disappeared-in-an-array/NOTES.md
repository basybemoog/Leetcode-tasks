Алгоритм получился плохим, потом что в нём используется цикл, внутри которого функция, которая использует цикл, решение перемудрено, надо будет исправить, возможно. O(n * n)